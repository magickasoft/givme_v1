"use strict";function PlayCtrl(e,t,n,o,i,a,m){e.animate=!0,e.persons={topAccepted:"",topRejected:"",bottomAccepted:"",bottomRejected:""},e.remain=5,e.remainSeconds="5 seconds",e.loaded=!1,e.loading="loading";var c=!1;e.message="SEARCHING...",e.maxTime=40,a.requestGame().then(function(i){var s=i.game,r=i.socket;r.onmessage=function(e){},e.loading="";var g=s.players[0],l=s.players[1];e.topPerson=new m({name:g.first_name+" "+g.last_name,age:g.age||0,domId:"topPerson",photos:[{full:"images/img-01.png",thumb:"images/img-thumb-01.png",active:!0},{full:"images/img-07.png",thumb:"images/img-thumb-07.png",active:!1},{full:"images/img-01.png",thumb:"images/img-thumb-01.png",active:!1},{full:"images/img-07.png",thumb:"images/img-thumb-07.png",active:!1},{full:"images/img-01.png",thumb:"images/img-thumb-01.png",active:!1}],languages:g.languages,iceBreakers:g.tags}),e.bottomPerson=new m({name:l.first_name+" "+l.last_name,age:l.age||0,domId:"bottomPerson",photos:[{full:"images/img-01.png",thumb:"images/img-thumb-06.png",active:!0},{full:"images/img-07.png",thumb:"images/img-thumb-07.png",active:!1},{full:"images/img-01.png",thumb:"images/img-thumb-08.png",active:!1}],languages:l.languages,iceBreakers:l.tags}),e.topPerson.onAccept=e.bottomPerson.onAccept=function(){e.topPerson.accepted&&a.acceptPlayer(g.id),e.bottomPerson.accepted&&a.acceptPlayer(l.id),(e.topPerson.accepted||e.bottomPerson.accepted)&&n(function(){c&&n.stop(c),o.cancel(p),t.go("match",{},{location:"replace"})},1e3)},e.topPerson.onReject=e.bottomPerson.onReject=function(){e.topPerson.rejected&&a.rejectPlayer(g.id),e.bottomPerson.rejected&&a.rejectPlayer(l.id),e.topPerson.rejected&&e.bottomPerson.rejected&&($("#reject").modal("show"),c&&n.stop(c),o.cancel(p),o(function(){e.remain--,e.remain>1?e.remainSeconds=e.remain+" seconds":e.remainSeconds=e.remain+" second"},1e3),n(function(){$("#reject").modal("hide"),t.reload()},5e3))},n(function(){e.loaded=!0,e.transition="none",e.percentage=0,e.currentTime=0,e.message="TIME IS RUNNING OUT",$(".slide-flip-block").css("height",$(".slide-flip-block").find("img").height()+3),$(".slide-flip-block").flip({axis:"x",speed:200})},1e3),e.percentage=0,e.currentTime=0,e.message="SEARCHING...";var p=o(function(){e.loaded&&e.currentTime>=e.maxTime?($("#time-is-up").modal("show"),o.cancel(p),o(function(){e.remain--,e.remain>1?e.remainSeconds=e.remain+" seconds":e.remainSeconds=e.remain+" second"},1e3),c=n(function(){$("#time-is-up").modal("hide"),t.reload()},5e3)):e.loaded&&(e.transition="all linear 1s",e.percentage=e.currentTime/e.maxTime*100,e.currentTime++)},1e3);e.timeoutProgress=function(){return{width:e.percentage+"%",transition:e.transition}},e.timeoutSeconds=function(){return e.maxTime-e.currentTime},e.$watchCollection("persons",function(t){1==t.topAccepted?e.topPerson.accept():(1==t.topRejected&&e.topPerson.reject(),1==t.bottomAccepted?e.bottomPerson.accept():1==t.bottomRejected&&e.bottomPerson.reject())})})["catch"](function(e){console.log(JSON.stringify(e))})}angular.module("givmeApp.controllers").controller("PlayCtrl",["$scope","$state","$timeout","$interval","$ionicLoading","GmAPI","PlayPersonPreview",PlayCtrl]);